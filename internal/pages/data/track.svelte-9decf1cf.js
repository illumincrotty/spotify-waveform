import{S as M,i as B,s as N,k as v,f as w,d as m,K as S,L as A,a as C,b as i,W as I,O as K,v as z,w as E,x as L,p as g,n as y,A as P,J as T,u as O,m as G,o as H,a4 as Q}from"../../chunks/vendor-afb1c40f.js";import{P as R}from"../../chunks/page-f79f5392.js";import{t as U}from"../../chunks/storeSession-22863b82.js";import{c as V}from"../../chunks/track.svelte_svelte_type_style_lang-a4055f75.js";import{p as X}from"../../chunks/stores-440f6bf6.js";import"../../chunks/button-ca07cb2d.js";function W(n,t,l){const e=n.slice();return e[2]=t[l],e[4]=l,e}function Y(n){let t,l,e,r;return{c(){t=S("rect"),this.h()},l(a){t=A(a,"rect",{x:!0,y:!0,width:!0,height:!0,rx:!0}),C(t).forEach(m),this.h()},h(){i(t,"x",l=n[4]/p*($+d)),i(t,"y",e=f/2-f*n[2]/2),i(t,"width",$),i(t,"height",r=f*n[2]),i(t,"rx","2")},m(a,s){w(a,t,s)},p(a,s){s&1&&e!==(e=f/2-f*a[2]/2)&&i(t,"y",e),s&1&&r!==(r=f*a[2])&&i(t,"height",r)},d(a){a&&m(t)}}}function q(n){let t,l=n[4]%p==0&&Y(n);return{c(){l&&l.c(),t=v()},l(e){l&&l.l(e),t=v()},m(e,r){l&&l.m(e,r),w(e,t,r)},p(e,r){e[4]%p==0&&l.p(e,r)},d(e){l&&l.d(e),e&&m(t)}}}function Z(n){let t,l,e=n[0],r=[];for(let a=0;a<e.length;a+=1)r[a]=q(W(n,e,a));return{c(){t=S("svg");for(let a=0;a<r.length;a+=1)r[a].c();this.h()},l(a){t=A(a,"svg",{xmlns:!0,viewBox:!0,"fill-rule":!0,"clip-rule":!0,"stroke-linejoin":!0,"stroke-miterlimit":!0,"aria-label":!0});var s=C(t);for(let o=0;o<r.length;o+=1)r[o].l(s);s.forEach(m),this.h()},h(){i(t,"xmlns","http://www.w3.org/2000/svg"),i(t,"viewBox",l="0 0 "+Math.ceil(n[0].length/p*($+d)-d)+" "+f),i(t,"fill-rule","evenodd"),i(t,"clip-rule","evenodd"),i(t,"stroke-linejoin","round"),i(t,"stroke-miterlimit","2"),i(t,"aria-label",n[1])},m(a,s){w(a,t,s);for(let o=0;o<r.length;o+=1)r[o].m(t,null)},p(a,[s]){if(s&1){e=a[0];let o;for(o=0;o<e.length;o+=1){const h=W(a,e,o);r[o]?r[o].p(h,s):(r[o]=q(h),r[o].c(),r[o].m(t,null))}for(;o<r.length;o+=1)r[o].d(1);r.length=e.length}s&1&&l!==(l="0 0 "+Math.ceil(a[0].length/p*($+d)-d)+" "+f)&&i(t,"viewBox",l),s&2&&i(t,"aria-label",a[1])},i:I,o:I,d(a){a&&m(t),K(r,a)}}}const $=4,d=1,p=1,f=100;function ee(n,t,l){let{data:e=[]}=t,{label:r="Chart"}=t;return n.$$set=a=>{"data"in a&&l(0,e=a.data),"label"in a&&l(1,r=a.label)},[e,r]}class te extends M{constructor(t){super();B(this,t,ee,Z,N,{data:0,label:1})}}function F(n){let t,l;return t=new te({props:{data:n[0]}}),{c(){z(t.$$.fragment)},l(e){E(t.$$.fragment,e)},m(e,r){L(t,e,r),l=!0},p(e,r){const a={};r&1&&(a.data=e[0]),t.$set(a)},i(e){l||(g(t.$$.fragment,e),l=!0)},o(e){y(t.$$.fragment,e),l=!1},d(e){P(t,e)}}}function ae(n){let t,l,e=n[0]&&F(n);return{c(){e&&e.c(),t=v()},l(r){e&&e.l(r),t=v()},m(r,a){e&&e.m(r,a),w(r,t,a),l=!0},p(r,a){r[0]?e?(e.p(r,a),a&1&&g(e,1)):(e=F(r),e.c(),g(e,1),e.m(t.parentNode,t)):e&&(G(),y(e,1,1,()=>{e=null}),H())},i(r){l||(g(e),l=!0)},o(r){y(e),l=!1},d(r){e&&e.d(r),r&&m(t)}}}function re(n){let t,l;return t=new R({props:{title:n[1],$$slots:{default:[ae]},$$scope:{ctx:n}}}),{c(){z(t.$$.fragment)},l(e){E(t.$$.fragment,e)},m(e,r){L(t,e,r),l=!0},p(e,[r]){const a={};r&2&&(a.title=e[1]),r&4097&&(a.$$scope={dirty:r,ctx:e}),t.$set(a)},i(e){l||(g(t.$$.fragment,e),l=!0)},o(e){y(t.$$.fragment,e),l=!1},d(e){P(t,e)}}}function le(n,t,l){let e,r;T(n,U,u=>l(8,e=u)),T(n,X,u=>l(9,r=u));let{trackID:a=""}=t,s,o,h="Track Name";O(()=>{a===""&&(console.debug(r.url),l(2,a=r.url.hash)),console.debug(`id: ${a}`),e!=="empty"&&J(e),Q().then(()=>{})});const J=async u=>{s=V(u);const x=await s.track(a);l(1,h=`${x.name} by ${x.artists[0].name}`),s.track(a),s.audioFeatures(a),s.audioAnalysis(a);let k=await s.audioAnalysis(a);Math.min(...k.segments.map(c=>c.loudness_max));let _=k.segments.map(c=>({time:c.start,duration:c.duration,loud:1-Math.min(Math.max(c.loudness_max,-35),0)/-35}));l(0,o=_.map(c=>c.loud));const j=[];let b=0;console.log(`Duration: ${k.track.duration}`);for(let c=0;c<100;c++){const D=k.track.duration/100*c;for(console.log(D);_.length-1>b&&_[b+1].time<=D;)b+=1;j.push(_[b].loud)}l(0,o=j),console.log(_),console.log(j)};return n.$$set=u=>{"trackID"in u&&l(2,a=u.trackID)},[o,h,a]}class fe extends M{constructor(t){super();B(this,t,le,re,N,{trackID:2})}}export{fe as default};

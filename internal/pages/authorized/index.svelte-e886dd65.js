import{S as v,i as w,s as x,v as p,w as g,x as h,p as _,n as $,A as d,J as y,u as M,e as j,c as S,a as D,d as k,b as A,f as L,Z as P}from"../../chunks/vendor-afb1c40f.js";import{L as C}from"../../chunks/loader-654d6340.js";import{P as E}from"../../chunks/page-f79f5392.js";import{g as f}from"../../chunks/navigation-51f4a605.js";import{b as m}from"../../chunks/paths-28a87002.js";import{t as b}from"../../chunks/storeSession-22863b82.js";import{v as R}from"../../chunks/authentication-9bd31127.js";/* empty css                                                                */import"../../chunks/button-ca07cb2d.js";import"../../chunks/singletons-12a22614.js";function T(c){let s,n,e;return n=new C({}),{c(){s=j("div"),p(n.$$.fragment),this.h()},l(t){s=S(t,"DIV",{class:!0});var o=D(s);g(n.$$.fragment,o),o.forEach(k),this.h()},h(){A(s,"class","center-i")},m(t,o){L(t,s,o),h(n,s,null),e=!0},i(t){e||(_(n.$$.fragment,t),e=!0)},o(t){$(n.$$.fragment,t),e=!1},d(t){t&&k(s),d(n)}}}function q(c){let s,n;return s=new E({props:{title:"Authenticating",$$slots:{default:[T]},$$scope:{ctx:c}}}),{c(){p(s.$$.fragment)},l(e){g(s.$$.fragment,e)},m(e,t){h(s,e,t),n=!0},p(e,[t]){const o={};t&8&&(o.$$scope={dirty:t,ctx:e}),s.$set(o)},i(e){n||(_(s.$$.fragment,e),n=!0)},o(e){$(s.$$.fragment,e),n=!1},d(e){d(s,e)}}}function z(c,s,n){let e;y(c,b,r=>n(0,e=r)),M(()=>{e!=="empty"?(console.log("already exists"),console.log(e),f(`${m}/data`)):o()});const t=({status:r,error:l,redirect:i})=>{const u=i!=null?i:`${m}/#${r}=${l}`;f(u)},o=async()=>{const r=new URLSearchParams(window.location.search),l=r.get("code"),i=r.get("state");if(!l)return t({status:302,error:"Missing Code Data"});i||t({status:302,error:"Missing State Data"});const u=await R(l,i);if(u.ok){const a=await u.json();(a==null?void 0:a.access_token)||t({status:412,error:"Missing Access Token"}),(a==null?void 0:a.refresh_token)||t({status:412,error:"Missing Refresh Token"}),(a==null?void 0:a.expires_in)||t({status:412,error:"Missing Expiration"}),P(b,e={access_token:a.access_token,refresh_token:a.refresh_token,expires_at:Date.now()+1e3*+a.expires_in},e),console.log("Debug: 200"),console.log(e),await f(`${m}/data`)}else console.log("1"),t({status:404,error:"response not ok"})};return[]}class N extends v{constructor(s){super();w(this,s,z,q,x,{})}}export{N as default};

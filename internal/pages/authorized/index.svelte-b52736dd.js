import{S as j,i as x,s as S,j as l,m as p,o as m,x as _,u as d,v as k,J as w,A,e as h,t as M,c as g,a as v,g as q,d as c,f as u,F as D,h as E,k as T,n as I,b as L,X as P}from"../../chunks/vendor-cdbb4087.js";import{b as $}from"../../chunks/paths-28a87002.js";import{v as V}from"../../chunks/authentication-a60c1d91.js";import{L as z}from"../../chunks/loader-6cbed9a5.js";import{P as C}from"../../chunks/page-d5e70828.js";import{t as b}from"../../chunks/storeSession-2643e21d.js";import{g as f}from"../../chunks/navigation-51f4a605.js";/* empty css                                                                */import"../../chunks/singletons-12a22614.js";function y(i){let s,n;return{c(){s=h("div"),n=M(i[0])},l(e){s=g(e,"DIV",{});var a=v(s);n=q(a,i[0]),a.forEach(c)},m(e,a){u(e,s,a),D(s,n)},p(e,a){a&1&&E(n,e[0])},d(e){e&&c(s)}}}function F(i){let s,n,e,a,r=i[0]&&y(i);return e=new z({}),{c(){r&&r.c(),s=T(),n=h("div"),l(e.$$.fragment),this.h()},l(t){r&&r.l(t),s=I(t),n=g(t,"DIV",{class:!0});var o=v(n);p(e.$$.fragment,o),o.forEach(c),this.h()},h(){L(n,"class","center-i")},m(t,o){r&&r.m(t,o),u(t,s,o),u(t,n,o),m(e,n,null),a=!0},p(t,o){t[0]?r?r.p(t,o):(r=y(t),r.c(),r.m(s.parentNode,s)):r&&(r.d(1),r=null)},i(t){a||(_(e.$$.fragment,t),a=!0)},o(t){d(e.$$.fragment,t),a=!1},d(t){r&&r.d(t),t&&c(s),t&&c(n),k(e)}}}function J(i){let s,n;return s=new C({props:{title:"Authenticating",$$slots:{default:[F]},$$scope:{ctx:i}}}),{c(){l(s.$$.fragment)},l(e){p(s.$$.fragment,e)},m(e,a){m(s,e,a),n=!0},p(e,[a]){const r={};a&9&&(r.$$scope={dirty:a,ctx:e}),s.$set(r)},i(e){n||(_(s.$$.fragment,e),n=!0)},o(e){d(s.$$.fragment,e),n=!1},d(e){k(s,e)}}}const W=async({page:i,fetch:s,session:n,stuff:e})=>{{const a=i.query.get("code"),r=i.query.get("state");if(!a)return{status:302,redirect:`${$}/`};if(!r)return{status:302,redirect:`${$}/`};if(a&&r){const t=await V(a,r,s);if(t.ok){const o=await t.json();return(o==null?void 0:o.access_token)?(o==null?void 0:o.refresh_token)?(o==null?void 0:o.expires_in)?{status:200,props:{token_prop:{access_token:o.access_token,refresh_token:o.refresh_token,expires_at:Date.now()+1e3*+o.expires_in}}}:{status:412,error:"Missing Expiration"}:{status:412,error:"Missing Refresh Token"}:{status:412,error:"Missing Access Token"}}else return{status:t.status,error:t.statusText}}return{status:200}}};function N(i,s,n){let e;w(i,b,t=>n(2,e=t));let{token_prop:a=void 0}=s,{status:r=void 0}=s;return A(()=>{e&&f("data",{replaceState:!0}),a&&(P(b,e=a,e),f("data",{replaceState:!0})),f("")}),i.$$set=t=>{"token_prop"in t&&n(1,a=t.token_prop),"status"in t&&n(0,r=t.status)},[r,a]}class Y extends j{constructor(s){super();x(this,s,N,J,S,{token_prop:1,status:0})}}export{Y as default,W as load};

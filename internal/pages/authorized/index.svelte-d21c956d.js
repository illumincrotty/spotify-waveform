import{S as v,i as w,s as x,v as p,w as g,x as $,p as h,n as _,A as d,G as M,u as y,e as D,c as S,a as j,d as k,b as A,f as L,O as P}from"../../chunks/vendor-cee53150.js";import{g as f,t as b,v as C}from"../../chunks/storeSession-bb05b2b6.js";import{b as m}from"../../chunks/paths-28a87002.js";import{P as E}from"../../chunks/page-50ce4a6d.js";import{L as G}from"../../chunks/loader-9d6873c8.js";import"../../chunks/stateGen-632403f6.js";import"../../chunks/singletons-a42a5e91.js";import"../../chunks/buttonBase-4b7a79ec.js";function R(i){let s,a,e;return a=new G({}),{c(){s=D("div"),p(a.$$.fragment),this.h()},l(t){s=S(t,"DIV",{class:!0});var o=j(s);g(a.$$.fragment,o),o.forEach(k),this.h()},h(){A(s,"class","center-i")},m(t,o){L(t,s,o),$(a,s,null),e=!0},i(t){e||(h(a.$$.fragment,t),e=!0)},o(t){_(a.$$.fragment,t),e=!1},d(t){t&&k(s),d(a)}}}function T(i){let s,a;return s=new E({props:{title:"Authenticating",$$slots:{default:[R]},$$scope:{ctx:i}}}),{c(){p(s.$$.fragment)},l(e){g(s.$$.fragment,e)},m(e,t){$(s,e,t),a=!0},p(e,[t]){const o={};t&8&&(o.$$scope={dirty:t,ctx:e}),s.$set(o)},i(e){a||(h(s.$$.fragment,e),a=!0)},o(e){_(s.$$.fragment,e),a=!1},d(e){d(s,e)}}}function q(i,s,a){let e;M(i,b,r=>a(0,e=r)),y(()=>{e!=="empty"?(console.log("already exists"),console.log(e),f(`${m}/data`)):o()});const t=({status:r,error:u,redirect:c})=>{const l=c!=null?c:`${m}/#${r}=${u}`;f(l)},o=async()=>{const r=new URLSearchParams(window.location.search),u=r.get("code"),c=r.get("state");if(!u)return t({status:302,error:"Missing Code Data"});c||t({status:302,error:"Missing State Data"});const l=await C(u,c);if(l.ok){const n=await l.json();(n==null?void 0:n.access_token)||t({status:412,error:"Missing Access Token"}),(n==null?void 0:n.refresh_token)||t({status:412,error:"Missing Refresh Token"}),(n==null?void 0:n.expires_in)||t({status:412,error:"Missing Expiration"}),P(b,e={access_token:n.access_token,refresh_token:n.refresh_token,expires_at:Date.now()+1e3*+n.expires_in},e),console.log("Debug: 200"),console.log(e),await f(`${m}/data`)}else console.log("1"),t({status:404,error:"response not ok"})};return[]}class J extends v{constructor(s){super();w(this,s,q,T,x,{})}}export{J as default};

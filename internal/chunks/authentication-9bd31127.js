var p=Object.defineProperty;var a=Object.getOwnPropertySymbols;var _=Object.prototype.hasOwnProperty,g=Object.prototype.propertyIsEnumerable;var i=(e,t,o)=>t in e?p(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,c=(e,t)=>{for(var o in t||(t={}))_.call(t,o)&&i(e,o,t[o]);if(a)for(var o of a(t))g.call(t,o)&&i(e,o,t[o]);return e};import{b as m}from"./paths-28a87002.js";import{g as l}from"./navigation-51f4a605.js";import"./storeSession-22863b82.js";const u=(e=32)=>crypto.getRandomValues(new Uint8Array(e)),d=(e=32)=>f(u(e)),f=e=>window.btoa(String.fromCodePoint(...e)).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"),h=`https://illumincrotty.github.io${m}/authorized`,r="9f38f4f91f784811b42898766ee7211a",w=async e=>{const t=new TextEncoder().encode(e),o=await crypto.subtle.digest("SHA-256",t);return f(new Uint8Array(o))},k=async()=>{const e=d(64),t=d(64);sessionStorage.setItem("code_verifier",e),sessionStorage.setItem("state",t);const o={client_id:r,redirect_uri:h,state:`${t}`,scope:"user-read-private user-top-read",response_type:"code",show_dialog:"false",code_challenge_method:"S256",code_challenge:await w(e)};return void l(`https://accounts.spotify.com/authorize/?${new URLSearchParams(c({},o)).toString()}`)},C=(e,t,o=fetch)=>{const s=sessionStorage.getItem("state"),n=sessionStorage.getItem("code_verifier");if(!n)throw new Error("No Code Verifier in session");if(!s)throw new Error("No State in session");if(s!==t)throw new Error("State mismatch");return o("https://accounts.spotify.com/api/token",{method:"POST",body:new URLSearchParams({grant_type:"authorization_code",code:e,redirect_uri:h,client_id:r,code_verifier:n})})},T=async e=>{if(e.expires_at>=Date.now())return e;const t=await fetch("https://accounts.spotify.com/api/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({grant_type:"refresh_token",refresh_token:e.refresh_token,client_id:r})});if(t.ok){const o=await t.json();return{access_token:o.access_token,refresh_token:e.refresh_token,expires_at:Date.now()+1e3*+o.expires_in}}return!1};export{k as l,T as r,C as v};

var h=Object.defineProperty;var a=Object.getOwnPropertySymbols;var m=Object.prototype.hasOwnProperty,p=Object.prototype.propertyIsEnumerable;var n=(e,t,o)=>t in e?h(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,i=(e,t)=>{for(var o in t||(t={}))m.call(t,o)&&n(e,o,t[o]);if(a)for(var o of a(t))p.call(t,o)&&n(e,o,t[o]);return e};import{b as l}from"./paths-28a87002.js";import{g as u}from"./navigation-51f4a605.js";const _=(e=32)=>crypto.getRandomValues(new Uint8Array(e)),c=(e=32)=>d(_(e)),d=e=>window.btoa(String.fromCodePoint(...e)).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"),f=`https://illumincrotty.github.io${l}/authorized`,g="9f38f4f91f784811b42898766ee7211a",y=async e=>{const t=new TextEncoder().encode(e),o=await crypto.subtle.digest("SHA-256",t);return d(new Uint8Array(o))},b=async()=>{const e=c(64),t=c(64);sessionStorage.setItem("code_verifier",e),sessionStorage.setItem("state",t);const o={client_id:g,redirect_uri:f,state:`${t}`,scope:"user-read-private user-top-read",response_type:"code",show_dialog:"false",code_challenge_method:"S256",code_challenge:await y(e)};return void u(`https://accounts.spotify.com/authorize/?${new URLSearchParams(i({},o)).toString()}`)},C=(e,t,o=fetch)=>{const r=sessionStorage.getItem("state"),s=sessionStorage.getItem("code_verifier");if(!s)throw new Error("No Code Verifier in session");if(!r)throw new Error("No State in session");if(r!==t)throw new Error("State mismatch");return o("https://accounts.spotify.com/api/token",{method:"POST",body:new URLSearchParams({grant_type:"authorization_code",code:e,redirect_uri:f,client_id:g,code_verifier:s})})};export{b as l,C as v};
